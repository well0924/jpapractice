<!DOCTYPE html>
<html
xmlns="http://www.w3.org/1999/xhtml"
xmlns:th="http://www.thymeleaf.org" 
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>회원가입</title>
<!-- bootstrap5 -->
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<!-- jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
</head>
<body>
<th:block th:replace="/layout/header :: headerfragment"></th:block>
<form name="registerForm" class="form-signin" action="" method="post">

    <h1 class="h3 mb-3 fw-normal">회원가입</h1>
    <hr>
	
	<label th:for="useremail" class="form-label">아이디</label>
    <div class="mb-3 abc">
        <input type="email" class="form-control mx-1 overlap" id="userId" name="username" placeholder="아이디를 입력해 주세요">
        <input class="btn btn-outline-primary btn-sm idCheck mx-1" type="button" id="usernameOverlay" onclick="usernameCheck()" value="중복 체크"/>
        <input class="btn btn-outline-success btn-sm reType" type="button" id="resetUsername" onclick="reUsername()" value="다시입력"/>
        <div id="valid_userid"></div>
        <div id="duplicatedid"></div>
    </div>

    <div class="mb-3">
        <label th:for="pwd">패스워드</label>
        <input type="password" class="form-control" name="password" id="pwd" placeholder="비밀번호를 입력해 주세요" autocomplete="off">
    	<div id="valid_password"></div>
    </div>

    <div class="mb-3">
        <label for="password_check">패스워드 확인</label>
        <input onchange="pwSame()" type="password" class="form-control" id="pwd_check"  placeholder="비밀번호를 입력해 주세요" autocomplete="off">
        <span id="pw_check_msg"></span>       
    </div>

    <label th:for="memberName" class="form-label">이름</label>
    <div class="mb-3 abc">
        <input type="text" class="form-control mx-1 overlap" id="memberName" name="membername" placeholder="이름을 입력해 주세요">
		<div id="valid_username"></div>
    </div>
	
	<label th:for="userEmail" class="form-label">이메일</label>
   	<div class="mb-3 abc">
        <input type="text" class="form-control mx-1 overlap" id="userEmail" name="useremail" placeholder="이메일을 입력해 주세요">
    	<div id="valid_useremail"></div>
    </div>
	
    <div class="mb-3">
        <button class="w-100 btn btn-lg btn-primary" type="button" onclick="signUp()">회원가입</button>
    </div>
    <div class="mb-3">
        <a type="button" style="color:white" class="w-100 btn btn-lg btn-secondary" onclick="window.history.back();">취소</a>
    </div>
</form>
<th:block th:replace="/layout/footer :: footerfragment"></th:block>
<script type="text/javascript">
function validation(){
	let userid = $('#userId').val();
	
	if(userid.trim()== 0){
		$('#duplicatedid').text('아이디를 입력해 주세요.');
		$('#duplicatedid').css('color','red');
		return false;
	}
	return true;
}

function usernameCheck(){
	let userid = $('#userId').val();
	
	if(validation()){
		$.ajax({
			url:'/api/login/logincheck/'+ userid,
			type:'get',
			dataType:'json',
			contentType:'application/json; charset = utf-8'	
		}).done(function(resp){
			console.log(resp);
			if(resp == true){
				$('#duplicatedid').text('사용가능!');
				$('#duplicatedid').css('color','blue');
			}
		}).fail(function(error){
			$('#duplicatedid').text('아이디 중복!');
			$('#duplicatedid').css('color','red');
		});	
	}
}
//아이디 재입력
function reUsername(){
	let id =$('#userId').val(' ');
}
function pwSame(){
	let pwd = $('#pwd').val();
	let pwdcheck = $('#pwd_check').val();
	
	if(pwd.trim()==pwdcheck.trim()){
		$('#pw_check_msg').text('비밀번호가 일치 합니다.');	
		$('#pw_check_msg').css('color','blue');
	}else{
		$('#pw_check_msg').text('비밀번호가 일치하지 않습니다.');	
		$('#pw_check_msg').css('color','red');
	}
}
//회원가입
function signUp(){
	let id= $('#userId').val();
	let pw= $('#pwd').val();
	let email = $('#userEmail').val();
	let name = $('#memberName').val();
	
	const joindate = {
			username : id,
			password : pw,
			useremail : email,
			membername : name
	};
	
	$.ajax({
		url:'/api/login/memberjoin',
		type:'post',
		data:JSON.stringify(joindate),
		dataType:'json',
		contentType:'application/json; charset = utf-8'
	}).done(function(resp){
		if(resp.status == 400){
			
			if(resp.data.hasOwnProperty('valid_username')){
				$('#valid_userid').text(resp.data.valid_username);
				$('#valid_userid').css('color','red');
			}else{
				$('#valid_userid').text('');
			}
			if(resp.data.hasOwnProperty('valid_password')){
				$('#valid_password').text(resp.data.valid_password);
				$('#valid_password').css('color','red');
			}else{
				$('#valid_password').text('');
			}
			if(resp.data.hasOwnProperty('valid_membername')){
				$('#valid_username').text(resp.data.valid_membername);
				$('#valid_username').css('color','red');
			}else{
				$('#valid_username').text('');
			}
			if(resp.data.hasOwnProperty('valid_useremail')){
				$('#valid_useremail').text(resp.data.valid_useremail);
				$('#valid_useremail').css('color','red');
			}else{
				$('#valid_useremail').text('');
			}
		}else{
			alert('회원가입이 되었습니다.');
			location.href='/page/board/list';
		}
	}).fail(function(error){
		alert(JSON.stringify(error));
	});
}
</script>
</body>
</html>